---
---
<button id="cart-button" class="cart-button" aria-label="Ver carrito">
  游 <span id="cart-count" class="cart-count">0</span>
</button>

<script is:inline>
  const button = document.getElementById('cart-button');
  const countEl = document.getElementById('cart-count');

  function updateCount() {
    if (window.cartStore) {
      const count = window.cartStore.getItemCount();
      const prevCount = parseInt(countEl.textContent || '0');
      
      if (countEl) {
        countEl.textContent = count.toString();
        
        if (count > 0) {
          countEl.style.display = 'flex';
          // Animar el badge si aument칩 el contador
          if (count > prevCount) {
            countEl.classList.add('bounce');
            setTimeout(() => countEl.classList.remove('bounce'), 600);
          }
        } else {
          countEl.style.display = 'none';
        }
      }
      
      // Animar el bot칩n completo cuando se a침ade un item
      if (count > prevCount && button) {
        button.classList.add('pulse');
        setTimeout(() => button.classList.remove('pulse'), 600);
      }
    }
  }

  button?.addEventListener('click', () => {
    // Siempre permitir ir al checkout, incluso si est치 vac칤o
    window.location.href = '/checkout';
  });

  // Hacer el bot칩n m치s visible cuando hay items
  function updateButtonVisibility() {
    if (button && window.cartStore) {
      const count = window.cartStore.getItemCount();
      if (count > 0) {
        button.classList.add('has-items');
      } else {
        button.classList.remove('has-items');
      }
    }
  }

  window.addEventListener('cart-updated', () => {
    updateCount();
    updateButtonVisibility();
  });
  
  updateCount();
  updateButtonVisibility();
</script>

<style>
  .cart-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary-color);
    color: var(--white);
    border: none;
    border-radius: 50%;
    width: 65px;
    height: 65px;
    font-size: 1.8rem;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    transition: var(--transition);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-button:hover {
    background: var(--primary-dark);
    transform: scale(1.1);
  }

  .cart-button.has-items {
    animation: attention 2s ease-in-out infinite;
  }

  @keyframes attention {
    0%, 100% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
    50% { box-shadow: 0 4px 20px rgba(212, 160, 23, 0.6); }
  }

  .cart-count {
    position: absolute;
    top: -2px;
    right: -2px;
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 700;
    border: 2px solid var(--white);
  }

  .cart-count[style*="inline"],
  .cart-count[style*="flex"] {
    display: flex;
  }

  /* Animaciones mejoradas siguiendo patrones de e-commerce */
  @keyframes bounce {
    0%, 100% { transform: scale(1); }
    25% { transform: scale(1.3); }
    50% { transform: scale(0.9); }
    75% { transform: scale(1.15); }
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }

  :global(.cart-count.bounce) {
    animation: bounce 0.6s ease-in-out;
  }

  :global(.cart-button.pulse) {
    animation: pulse 0.6s ease-in-out;
  }

  @media (max-width: 768px) {
    .cart-button {
      bottom: 15px;
      right: 15px;
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
    }

    .cart-count {
      width: 24px;
      height: 24px;
      font-size: 0.75rem;
    }
  }
</style>
